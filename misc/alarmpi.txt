sudo fdisk /dev/sdb
o ret
n ret 1 ret ret +100M ret
t ret c ret
n ret 2 ret ret       ret
w

sudo mkfs.vfat /dev/sdb1
sudo mkdir boot
sudo mount /dev/sdb1 boot

sudo mkfs.ext4 /dev/sdb2
sudo mkdir root
sudo mount /dev/sdb2 root

wget http://archlinuxarm.org/os/ArchLinuxARM-rpi-latest.tar.gz
sudo bsdtar -xpf ArchLinuxARM-rpi-latest.tar.gz -C root
sync

sudo mv root/boot/* boot

sudo umount boot root

* Login as the default user alarm with the password alarm.
* The default root password is root.

==================================================================================================================

#dd bs=1M if=ArchLinuxARM*.img of=/dev/mmcblk0p5
#fdisk /dev/mmcblk0 => d 2 n e ret ret ret n l ret ret (del part 2, new extended part at 2, new logical  part at 5)
#e2fsck /dev/mmcblk0p5
#resize2fs /dev/mmcblk0p5

#In /boot/config.txt
#hdmi_force_hotplug=1
#hdmi_group=2 hdmi_mode=16 (1024x768@60Hz)


function setup_general() {
#pacman -Scc

	#rm -rf /etc/pacman.d/gnupg
	#pacman-key  --init
	#pacman -Syu
	#pacman -S --needed --noconfirm archlinux-keyring
	#pacman-key --populate archlinux
	#pacman-key --refresh-keys

	pacman -Syu --noconfirm
	pacman -S --needed --noconfirm sudo mc htop lsof unrar unzip p7zip unace lrzip emacs tmux samba wget git
	
	#
	sed -i '/^hosts:/ s/$/ wins/' /etc/nsswitch.conf
	
	#
	mkdir -p /mnt/shared/
	sudo setfacl -R -d -m o::rwx /mnt/shared/
	sudo setfacl -R -d -m g::rwx /mnt/shared/	
	ln -sf  /mnt/shared/ /srv/http/shared
	ln -sf /srv/http /mnt/shared/http
	
	echo -e "\n\n/dev/sda1 /mnt/shared/ ext4 defaults,nofail,acl 0 0" >> /etc/fstab
	echo -e "#/dev/sda1 /mnt/shared/ ntfs-3g nofail,relatime,uid=1000,gid=1001,umask=000 0 0" >> /etc/fstab

	#
	nano /etc/sudoers
	echo -e '\narcher  ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers
	
	groupadd sudo
	useradd -m -U -G sudo -s /bin/bash archer
	echo archer:pass | chpasswd
	
	#
	echo -e '#!/bin/bash\ncpuTemp0=$(cat /sys/class/thermal/thermal_zone0/temp)\ncpuTemp1=$(($cpuTemp0/1000))\ncpuTemp2=$(($cpuTemp0/100))\ncpuTempM=$(($cpuTemp2 % $cpuTemp1))\n\necho CPU temp"="$cpuTemp1"."$cpuTempM"\xc2\xb0C"\necho GPU $(/opt/vc/bin/vcgencmd measure_temp)' > gettemp.sh
	
	
	sudo timedatectl set-timezone Australia/Sydney
}

function setup_samba() {
	cp -f /etc/samba/smb.conf.default /etc/samba/smb.conf
	sed -i 's/MYGROUP/WORKGROUP/g' /etc/samba/smb.conf
	sed -i 's/;  guest account = pcguest/  guest account = nobody/g' /etc/samba/smb.conf
	sed -i "/^\[global\]$/ a\ map to guest = Bad User" /etc/samba/smb.conf
	sed -i "/^\[global\]$/ a\ unix extensions = no" /etc/samba/smb.conf
	echo -e "\n[shared]\n path = /mnt/shared/\n guest ok = yes\n guest only = yes\n guest account = nobody\n create mask = 777\n force directory mode = 777\n writeable = yes\n browsable = yes\n follow symlinks = yes\n wide links = yes\n\n" >> /etc/samba/smb.conf
	
	systemctl enable smbd	
	systemctl start smbd
	systemctl enable nmbd
	systemctl start nmbd
}

function setup_wireless() {
	#sudo pacman -S --needed ifplugd
	#sudo mkdir -p /etc/network.d
	#echo -e 'CONNECTION="wireless"\nESSID="network_name"\nINTERFACE="wlan0"\nSCAN="yes"\nIP="dhcp"\nTIMEOUT="10"\nSECURITY="wpa"\nKEY="network_pass"' |  #sudo tee /etc/network.d/rhinocode  
	#sudo systemctl enable netctl@rhinocode
	
	#sudo systemctl enable netctl-ifplugd@interface.service
	
	
	
	
	
	git clone https://github.com/abperiasamy/rtl8812AU_8821AU_linux.git
#CONFIG_PLATFORM_I386_PC = n
#CONFIG_PLATFORM_ARM_RPI = y
	sudo make clean
	sudo make
	sudo make install
	sudo modprobe -a rtl8812au
	
	
	
	sudo cp /etc/netctl/examples/ethernet-dhcp /etc/netctl/ethernet
	sudo cp /etc/netctl/examples/wireless-wpa /etc/netctl/wireless
	sudo sed -i 's/MyNetwork/network_name/g' /etc/netctl/wireless
	sudo sed -i 's/WirelessKey/network_pass/g' /etc/netctl/wireless
	
	
Description='mywifi'\nInterface=wlan0\nConnection=wireless\nSecurity=wpa\nIP=dhcp\nESSID='network_name'\nKey='network_pass'\n

	
	
	WPAConfigSection=('pairwise=CCMP' 'group=CCMP')
	
	
	
	
	
	sudo pacman -Sy patch linux linux-headers fakeroot crda
	aur.sh rtl8812au-rpi-dkms-git armv6h
	
	#sudo pacman -S --needed networkmanager
	
	
	sudo sed -i 's/#\(WIRELESS_REGDOM="AU"\)/\1/g' /etc/conf.d/wireless-regdom
	
	#sudo find /lib/modules/$(uname -r) -type f -name \*.ko
	#sudo journalctl -b
	#dmesg -c
	sudo iwconfig
	
sudo netctl start wireless
sudo systemctl enable netctl@wireless.service
sudo systemctl disable netctl@wireless.service
sudo systemctl status netctl@wireless.service
sudo systemctl start netctl@wireless.service

sudo systemctl enable wpa_supplicant.service
sudo systemctl status wpa_supplicant.service

echo -e 'ctrl_interface=/run/wpa_supplicant\nupdate_config=1' > /etc/wpa_supplicant/example.conf

 
wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant/example.conf -D wext
wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant/example.conf -D nl80211
 wpa_supplicant -B -i enp4s0 -D wire
ip link

wpa_cli

#scan
#scan_results
#add_network
#set_network 0 ssid "network_name"
#set_network 0 psk "network_pass"
#enable_network 0
#save_config

dhcpcd  wlan0



echo -e 'ctrl_interface=/var/run/wpa_supplicant\nctrl_interface_group=wheel\nupdate_config=1\nfast_reauth=1\nap_scan=1\n' > /etc/wpa_supplicant/example.conf
wpa_passphrase network_name network_pass >> /etc/wpa_supplicant/example.conf
sed -i "/^network={$/ a\ \tpairwise=CCMP\n\tgroup=CCMP" /etc/wpa_supplicant/example.conf

wpa_supplicant -D wext -B -i wlan0 -c <(wpa_passphrase network_name network_pass)

systemctl enable wpa_supplicant@wlan0

sudo systemctl disable wpa_supplicant@wlan0
sudo systemctl disable wpa_supplicant.service

sudo pacman -S --needed rfkill


}